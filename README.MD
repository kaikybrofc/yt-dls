# yt-dls

API simples e leve para download de vÃ­deos do **YouTube** utilizando **yt-dlp** com **Node.js** e **Express**.

Projeto focado em:

* Facilidade de uso
* OrganizaÃ§Ã£o
* Pronto para VPS / produÃ§Ã£o
* IntegraÃ§Ã£o via API REST

---

## ğŸš€ Funcionalidades

* âœ… Download de vÃ­deos do YouTube
* ğŸ” ValidaÃ§Ã£o de links (somente YouTube)
* ğŸ” Suporte a cookies (anti-bot)
* ğŸ§  Uso de runtime JavaScript exigido pelo YouTube
* ğŸŒ API REST simples (`POST /download`)
* ğŸ“ OrganizaÃ§Ã£o automÃ¡tica de arquivos
* ğŸ§µ Fila e limite de concorrÃªncia para downloads
* ğŸ›ï¸ ConversÃ£o via FFmpeg (MP3/MP4)

---

## ğŸ§± Tecnologias utilizadas

* Node.js
* Express
* yt-dlp
* yt-dlp-wrap
* FFmpeg

---

## ğŸ“ Estrutura do projeto

```text
yt-dls/
â”œâ”€ src/
â”‚  â””â”€ server.js     # API principal
â”œâ”€ scripts/
â”‚  â”œâ”€ install.js    # Script de instalaÃ§Ã£o do yt-dlp
â”‚  â””â”€ test-request.js # Teste da API
â”œâ”€ package.json
â”œâ”€ cookies.txt      # Cookies do YouTube (formato Netscape)
â”œâ”€ bin/
â”‚  â””â”€ yt-dlp        # BinÃ¡rio do yt-dlp
â””â”€ downloads/
   â””â”€ <request_id>/
      â””â”€ video-xxxx.mp4
```

---

## ğŸ“¦ InstalaÃ§Ã£o

### 1ï¸âƒ£ Clonar o repositÃ³rio

```bash
git clone https://github.com/kaikybrofc/yt-dls.git
cd yt-dls
```

---

### 2ï¸âƒ£ Instalar dependÃªncias

```bash
npm install
```

---

### 3ï¸âƒ£ Instalar o yt-dlp

```bash
npm run install:yt-dlp
```

Isso irÃ¡ baixar automaticamente o binÃ¡rio correto do **yt-dlp** para seu sistema.

---

## ğŸ” ConfiguraÃ§Ã£o de cookies (OBRIGATÃ“RIO)

O YouTube bloqueia downloads sem autenticaÃ§Ã£o em VPS.

### âœ… Forma correta

1. FaÃ§a login no YouTube pelo navegador
2. Instale a extensÃ£o **Get cookies.txt (LOCALLY)**
3. Exporte os cookies
4. Salve o arquivo como `cookies.txt` na raiz do projeto

âš ï¸ O arquivo **precisa** estar no formato **Netscape**.

---

## â–¶ï¸ Executando a API

```bash
npm start
```

Servidor rodando em:

```
http://localhost:3000
```

---

## ğŸŒ Endpoints

### ğŸ”¹ Health check

```http
GET /
```

Resposta:

```json
{
  "status": "API yt-dlp online ğŸš€"
}
```

---

### ğŸ”¹ Buscar vÃ­deo por nome

```http
GET /search?q=termodebusca
```

Resposta (quando encontra):

```json
{
  "sucesso": true,
  "total": 1,
  "resultado": {
    "id": "VIDEO_ID",
    "title": "Titulo do video",
    "url": "https://www.youtube.com/watch?v=VIDEO_ID"
  }
}
```

Resposta (quando nÃ£o encontra):

```json
{
  "sucesso": true,
  "total": 0,
  "resultado": null
}
```

Erros:

```json
{
  "sucesso": false,
  "mensagem": "âŒ O parÃ¢metro 'q' Ã© obrigatÃ³rio."
}
```

---

### ğŸ”¹ Download de vÃ­deo ou Ã¡udio

```http
POST /download
Content-Type: application/json
```

Body:

```json
{
  "link": "https://youtu.be/VIDEO_ID",
  "type": "video",
  "request_id": "meu_id_123"
}
```

---

### âœ… Resposta de sucesso

Retorna o arquivo convertido diretamente (stream do binÃ¡rio).
Headers relevantes:

- `Content-Type`: `video/mp4` ou `audio/mpeg`
- `Content-Disposition`: `attachment; filename="..."`
- `X-Queue-Ahead`: quantos downloads estavam na frente
- `X-Queue-Limit`: limite de concorrÃªncia
- `X-Request-Id`: request_id usado

```json
<binary>
```

ObservaÃ§Ãµes:

* `type` Ã© opcional: `video` (padrÃ£o) ou `audio`
* Quando `type = audio`, o arquivo final Ã© `.mp3`
* `request_id` Ã© obrigatÃ³rio e deve conter apenas letras, nÃºmeros, `_` ou `-`
* O arquivo Ã© removido apÃ³s o envio (cleanup automÃ¡tico)

---

### âŒ Erros comuns

Link invÃ¡lido:

```json
{
  "sucesso": false,
  "mensagem": "âŒ O link informado nÃ£o Ã© do YouTube."
}
```

Cookies ausentes:

```json
{
  "sucesso": false,
  "mensagem": "âŒ Arquivo cookies.txt nÃ£o encontrado."
}
```

VÃ­deo sem faixa de Ã¡udio:

```json
{
  "sucesso": false,
  "mensagem": "âŒ O vÃ­deo baixado nÃ£o contÃ©m faixa de Ã¡udio."
}
```

Arquivo final nÃ£o localizado:

```json
{
  "sucesso": false,
  "mensagem": "âŒ Download finalizou, mas o arquivo nÃ£o foi localizado."
}
```

---

### ğŸ”¹ Status da fila por request_id

```http
GET /download/queue-status/:requestId
```

Resposta:

```json
{
  "sucesso": true,
  "request_id": "meu_id_123",
  "fila": {
    "status": "queued",
    "downloads_a_frente": 2,
    "posicao_na_fila": 1,
    "enfileirados": 3,
    "limite_concorrencia": 2,
    "limite_fila": 10
  }
}
```

---

### ğŸ”¹ Streaming do arquivo baixado

```http
GET /stream/:arquivo
```

Exemplo:

```http
GET /stream/Meu%20Video.mp4
Range: bytes=0-
```

Notas:

* Suporta `Range` para streaming progressivo
* O arquivo deve existir na pasta `downloads/`

---

## ğŸ“Œ ObservaÃ§Ãµes importantes

* ğŸš« NÃ£o copie cookies manualmente do navegador
* âœ… Use sempre cookies no formato Netscape
* âš ï¸ NÃ£o exponha sua API publicamente sem autenticaÃ§Ã£o
* ğŸ’¡ Ideal para uso interno ou controlado
* âš™ï¸ Configure o limite de conversÃ£o com `MAX_CONCURRENT_FFMPEG`

---

## ğŸ›£ï¸ Roadmap (futuras melhorias)

* ğŸ”„ Status de download
* ğŸ“Š Progresso em tempo real (WebSocket)
* ğŸ” AutenticaÃ§Ã£o por token
* ğŸ³ Docker

---

## ğŸ‘¤ Autor

**Kaiky Brito**
ğŸ”— GitHub: [https://github.com/kaikybrofc](https://github.com/kaikybrofc)

---

## ğŸ“„ LicenÃ§a

MIT License

---

ğŸš€ Projeto pronto para evoluir. ContribuiÃ§Ãµes sÃ£o bem-vindas
